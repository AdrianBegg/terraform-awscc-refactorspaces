# Example: Deploying and configuring AWS Refactor Spaces in a single account

The following example deploys AWS Refactor Spaces components within a single AWS account including the environment, application, and all service routes. We recommend only using this for proof-of-concept or testing purposes. In production, deploy microservices in separate AWS accounts to simplify implementation of least-privilege access models for a single application scope, simplify internal resource tracking and chargeback, and service limits and quotas. 

![Architecture for Migration Hub Refactor Spaces on AWS](https://raw.githubusercontent.com/aws-ia/terraform-awscc-refactorspaces/main/images/aws_migration_hub_refactor_spaces_basic.png)

Figure 1. Example configuration of AWS Migration Hub Refactor Spaces deployed with a monolithic application Unishop with a new AddToCart microservice, running as an AWS Lambda microservice.

As shown in the diagram, the solution in this example sets up the following:

* A highly available architecture that spans two Availability Zones.*
* One Virtual Private Cloud (VPC) to:
** Host a Network Load Balancer, deployed by AWS Migration Hub Refactor Spaces. Amazon API Gateway uses the Network Load Balancer and an AWS Transit Gateway attachment in the private subnet to communicate with workloads deployed in other VPCs. Amazon API Gateway is managed by AWS Migration Hub Refactor Spaces.*
* A second VPC to:
** Host the monolithic application Unistore legacy. Amazon API Gateway uses the Application Load Balancer and an AWS Transit Gateway attachment in the private subnet, and the Amazon API Gateway is managed by AWS Migration Hub Refactor Spaces.*
* In the private subnets of the second VPC:
** An Amazon Elastic Compute Cloud (Amazon EC2) instance to host the monolithic application Unistore legacy.*
* An Application Load Balancer to forward traffic to a Target group that contains the Amazon EC2 instances.*
* An AWS Migration Hub:
** Refactor Spaces environment configured to create a new AWS Transit Gateway. This environment is managed by AWS Migration Hub Refactor Spaces. An option is available to provision a network bridge for cross-account connectivity.
** An AWS Migration Hub Refactor Spaces application that creates an Amazon API Gateway.
* The following AWS Migration Hub Refactor Spaces services:
** Default service points to a monolithic application deployed on Amazon EC2. This service acts as the default route for traffic.
** AddToCart service points to a microservice deployed as an AWS Lambda function.
* A route that sends requests for the AddToCart domain to the Lambda function.
* A Network Load Balancer deployed in a provided VPC and connected to the Amazon API Gateway by AWS Migration Hub Refactor Spaces. This uses the VPC link feature.
* A Lambda function AddToCart that holds the modernized AddToCart business logic strangled from the Unistore legacy monolithic application.

*The Terraform module that deploys this solution does not include the components marked by asterisks but are provided as inputs and depicted to illustrate a real-world deployment scenario.