# Example: Deploying and configuring AWS Refactor Spaces in a single account

The following example deploys AWS Refactor Spaces components within a single AWS account including the environment, application, and all service routes. We recommend only using this for proof-of-concept or testing purposes. In production, deploy microservices in separate AWS accounts to simplify implementation of least-privilege access models for a single application scope, simplify internal resource tracking and chargeback, and service limits and quotas. 

![Architecture for Migration Hub Refactor Spaces on AWS](https://raw.githubusercontent.com/aws-ia/terraform-awscc-refactorspaces/main/images/aws_migration_hub_refactor_spaces_basic.png)

Figure 1. Example configuration of AWS Migration Hub Refactor Spaces deployed with a monolithic application Unishop with a new AddToCart microservice, running as an AWS Lambda microservice.

As shown in the diagram, the solution in this example sets up the following:

* A highly available architecture that spans two Availability Zones.*
* Two Virtual Private Clouds (VPCs) configured with private subnets, deployed across two Availability Zones:
  ** The first Amazon VPC to host a Network Load Balancer, deployed by AWS Migration Hub Refactor Spaces. The Amazon API Gateway uses this to communicate with workloads deployed in other VPCs (Attachment to the AWS Transit Gateway) and is managed by AWS Migration Hub Refactor Spaces.*
  ** The second Amazon VPC to host the monolithic application Unistore legacy (Attachment to the AWS Transit Gateway) and is managed by AWS Migration Hub Refactor Spaces.*
* In the private subnets of the second Amazon VPC:
  ** An Amazon Elastic Compute Cloud (Amazon EC2) instance to host the monolithic application Unistore legacy (Attachment to the AWS Transit Gateway).*
* An Application Load Balancer to forward traffic to a Target group that contains the Amazon EC2 instances (to host the monolithic application Unistore legacy).*
* An AWS Migration Hub:
  ** Refactor Spaces environment with the Provision a network bridge for cross account connectivity option (not shown) configured to create a new AWS Transit Gateway. This is managed by AWS Migration Hub Refactor Spaces.
  ** An AWS Migration Hub Refactor Spaces application that creates an Amazon API Gateway.
* The following AWS Migration Hub Refactor Spaces services:
  ** Default pointing to a monolithic application deployed on Amazon EC2. This service acts as the default route for traffic.
  ** AddToCart pointing at a microservice deployed as a Lambda function AddToCart that holds the modernized AddToCart business logic.
* A route that sends requests for the AddToCart domain to the Lambda function.
* A Network Load Balancer deployed in a provided Amazon VPC and connected to the Amazon API Gateway by AWS Migration Hub Refactor Spaces. This uses the VPC link feature.
* A Lambda function AddToCart that holds the modernized AddToCart business logic strangled from the Unistore legacy monolithic application.

*The Terraform module that deploys this solution does not include the components marked by asterisks but are provided as inputs and depicted to illustrate a real-world deployment scenario.